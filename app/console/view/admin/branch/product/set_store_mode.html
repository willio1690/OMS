<!--
  Copyright © ShopeX （http://www.shopex.cn）. All rights reserved.
  See LICENSE file for license details.
-->

<style>
#sell_end_time { padding-top:2px; padding-bottom:3px; }
</style>
<form action="index.php?app=console&ctl=admin_branch_product_extend&act=saveStoreMode" method="post" id='add-form'>
<div class="tableform">
    <div class="division">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
            <th><{t}><font color="red">*</font>选择店铺：<{/t}></th>
            <td>
                <select name="shop_id" id="shop_id" class="x-input dailog-batch-ipt" vtype='required'>
                <option value=''>请选择</option>
                <{foreach from=$shopList key=itemKey item=itemVal}>
                <option value='<{$itemVal.shop_id}>' ><{$itemVal.name}></option>
                <{/foreach}>
                </select>
            </td>
        </tr>
        <tr>
            <th><{t}><font color="red">*</font>库存销售模式：<{/t}></th>
            <td>
                <select name="store_sell_type" id="store_sell_type" class="x-input dailog-batch-ipt" vtype='required' onchange="ajax_get_sell_delay(this)">
                <option value=''>请选择</option>
                <{foreach from=$sellTypes key=itemKey item=itemVal}>
                <option value='<{$itemKey}>' <{if $itemKey==$data.store_sell_type}>selected="selected"<{/if}> ><{$itemVal}></option>
                <{/foreach}>
                </select>
            </td>
        </tr>
        <tr>
            <th><{t}><font color="red">*</font>发货时效：<{/t}></th>
            <td>
                <span id="sell_delay_box">
                <select name="sell_delay" class="x-input dailog-batch-ipt" vtype='required'>
                <option value=''>请选择</option>
                </select>
                </span>
                <span style="color:red;">&nbsp;&nbsp;*</span>
                <span id="get_delay_msg" style="color:red;">&nbsp;</span>
            </td>
        </tr>
        <tr id="set_sell_time" style="display:none;">
            <th><{t}><font color="red">*</font>全款预售截止时间：<{/t}></th>
            <td><{input id="sell_end_time" class="x-input dailog-batch-ipt" size="30" type='date' name='sell_time_date' value=$data.sell_end_time }>&nbsp;
                <{input type='select' class="x-input dailog-batch-ipt" name='sell_time_hour' value=$data.sell_time_hour options=$conf_hours }>：
                <{input type='select' class="x-input dailog-batch-ipt" name='sell_time_minitue' value=$data.sell_time_minitue options=$conf_minitue }>：
                <{input type='select' class="x-input dailog-batch-ipt" name='sell_time_second' value=$data.sell_time_second options=$conf_second }></td>
        </tr>
      </table>
    </div>
</div>
</form>
<script type="text/javascript">
$('store_sell_type').addEvents({
    'change':function(e){
        if(this.value == 'presell'){
            $ES('#set_sell_time').show();
        }else{
            $ES('#set_sell_time').hide();
        }
    },
    'domready':function(e){
        this.fireEvent('change', e);
    }
});

//ajax加载发货时效
function ajax_get_sell_delay(e)
{
    var ajax_html = '<select name="sell_delay" class="x-input dailog-batch-ipt" vtype="required"><option value="">请选择</option>';
    var sell_type = e.value;
    if(sell_type == ""){ return false; }
    
    new Request(
    {
        url: "index.php?app=console&ctl=admin_branch_product_extend&act=ajax_get_sell_delay",
        async:false,
        method:'post',
        data:{sell_type: sell_type},
        onComplete: function(json)
        {
            json = JSON.decode(json);
            
            if(json.res == 'empty'){
                alert("没有获取到发货时效");
            }else if(json.res == 'succ'){
                var delayList = json.sell_delays;
                
                delayList.each(function(rs, i)
                {
                    ajax_html += '<option value="'+ rs.key +'">'+ rs.value +'</option>';
                });
                
                ajax_html += '</select>';
                
                $("get_delay_msg").set('html', '');
                $("sell_delay_box").set('html', ajax_html);
            }else{
                alert("获取错误...");
            }
        }
        
    }).send();
}
</script>
