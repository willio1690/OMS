<!--
  Copyright © ShopeX （http://www.shopex.cn）. All rights reserved.
  See LICENSE file for license details.
-->

<form method="post" enctype="multipart/form-data" id="import_form" action="index.php?app=console&ctl=admin_stock_artificial_freeze&act=doImport&finder_vid=<{$env.get.finder_vid}>&finder_id=<{$env.get.finder_id}>" class="tableform">
<h2 class="head-title">库存预占导入</h2>
<div id="information" class="division" style="display:none;">
    <div style="color:#ff0000;"><b>错误信息如下：</b></div>
    <div id="errorInfo" style="width:450px;height:150px;padding:5px;overflow-y:auto;line-height:150%;border:1px solid #999;"></div>
</div>
<br />
<h4><br />
<{t}>第一步：导出模板<{/t}>&nbsp;&nbsp;<{button class="btn-primary" id='export_tpl_csv' label="下载" type="button"}>
</h4>
<br />
<h4>
<br />
<{t}>第二步：上传您要导入的文件<{/t}>
</h4>
<div class="division">
<table cellpadding="0" cellspacing="0" border="0">
	<tr>
		<th><{t}>上传文件：<{/t}></th>
		<td><input type="file" name="import_file" /></td>
	</tr>
	<tr>
		<th>&nbsp;</th>
		<td><{button id="btn-submit" class="btn-primary" label="上传" type="button"}></td>
	</tr>
</table>
</div>
</form>

<script>
(function(){
	
	$('export_tpl_csv').addEvent('click',function(){
		window.open("index.php?app=console&ctl=admin_stock_artificial_freeze&act=exportTemplate&finder_vid=<{$env.get.finder_vid}>&finder_id=<{$env.get.finder_id}>","_blank");
	});
	
	$('import_form').store('target',{
	    onComplete:function(jsontext){
	        var json = JSON.decode(jsontext);
	        if (json.result == 'succ'){
	            MessageBox.success('上传成功');
	            alert("上传成功 已加入队列 系统会自动跑完队列");
	        }else{
		        MessageBox.error('人工库存预占导入失败！');
		        $('information').style.display ='';
		        var errorInfo = '';
		        for(var key=0; key<json['msg'].length;key++){
		            errorInfo = errorInfo + json['msg'][key] + '<br />';
		        }
		        $('errorInfo').set('html', errorInfo);
	        }
	    }
	});
	    
	$('btn-submit').addEvent('click',function(){
	    $('information').style.display ='none';
	    $('errorInfo').set('html', '');
	    $('import_form').fireEvent('submit',{stop:$empty});
	});

})();
</script>