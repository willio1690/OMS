<!--
  Copyright © ShopeX （http://www.shopex.cn）. All rights reserved.
  See LICENSE file for license details.
-->

<div class="tableform" id="download-body">
    <div class="error" style="display: none;"></div>
    <form action="" method="post" id="download-form">
        <input type="hidden" name="baseApiUrl" value="index.php?app=vop&ctl=admin_vreturn_diff&act=doSync">
      <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <th>唯品会店铺：</th>
            <td>
              <select id="shop_id" name="shop_id">
                  <{foreach from=$shop_list key=key item=val}>
                  <option value="<{$val.shop_id}>"><{$val.name}></option>
                  <{/foreach}>
              </select>
            </td>
          </tr>
  
          <tr>
            <th>差异单号：</th>
            <td><{input name="rv_difference_no"}></td>
          </tr>
          <tr>
              <th>退供单号：</th>
              <td><{input name="return_no"}></td>
            </tr>
          <tr>
            <th>开始时间：</th>
            <td><{input type="time" name="begin_time"}></td>
          </tr>
          <tr>
            <th>结束时间：</th>
            <td><{input type="time" name="end_time"}></td>
          </tr>
     </table>
    </form>
    <div class="table-action">
        <{button label="下一步" class="btn btn-primary" id="download-search-btn"}>
        <{button label="关闭" class="btn btn-secondary" isCloseDialogBtn='true'}>
    </div>
</div>
<script>
    (function(){
        $('download-search-btn').addEvent('click', function(){
            if(! validate($('download-form'))) return;
    
            W.page('index.php?app=vop&ctl=admin_vreturn_diff&act=downloadPagePromise', {
                data:$('download-form').toQueryString(),
                method:'post',
                update:$('download-body'),
                onComplete:function(resp){
                    try {
                        resp = JSON.decode(resp);
                        if (resp.error){
                            $E('#download-body .error').show().setText(resp.error);
                        }

                        $('download-search-btn').set('disabled', false);
                    } catch(e) {}
                },
                onRequest:function(){
                    $E('#download-body .error').hide().empty();
    
                    $('download-search-btn').set('disabled', true);
                }
            });
        });
    })();
</script>