<!--
  Copyright © ShopeX （http://www.shopex.cn）. All rights reserved.
  See LICENSE file for license details.
-->

<div class="form-layout">
    <form method="post" id="fm1" action="index.php?app=monitor&ctl=admin_alarm_template&act=save">
        <div class="form-layout-block">
            <h3>基本信息</h3>
            <div class="form-layout-fields">
                <div class="form-field" style="width: 50%">
                    <span class="form-field-label">模板类型：</span>
                    <div class="form-radios">
                        <td>
                            <select id="event-type-select" name="event_type" data-search="true" style="width: 300px;">
                                <{foreach from=$eventType key=typeKey item=typeVal}>
                                    <option value="<{$typeKey}>"
                                        <{if $data}>
                                            <{if $data.event_type == $typeKey}>selected="selected"<{/if}>
                                        <{else}>
                                            <{if $typeKey=='oms_system'}>selected="selected"<{/if}>
                                        <{/if}>
                                    ><{$typeVal}></option>
                                <{/foreach}>
                            </select>
                            <!-- 默认模板内容映射（避免使用 <{json ...}>，用隐藏文本域承载） -->
                            <{foreach from=$eventDefaultContent key=mapKey item=mapVal}>
                                <textarea id="tpl-<{$mapKey}>" style="display:none;"><{$mapVal}></textarea>
                            <{/foreach}>
                        </td>

                    </div>
                </div>
            </div>
            <div class="form-layout-fields">
                <div class="form-field">
                    <span class="form-field-label"><span style="color:red;">*</span>模板名称：</span>
                    <input class="form-input" placeholder="请输入模板名称" type="text" name="template_name" size="60" value="<{$data.template_name}>" vtype="required" />
                </div>
            </div>
            <div class="form-layout-fields">
                <div class="form-field">
                    <span class="form-field-label"><span style="color:red;">*</span>模板编码：</span>
                    <input class="form-input" placeholder="请输入模板编码" type="text" name="template_bn" size="60" value="<{$data.template_bn}>" vtype="required" />
                </div>
            </div>
            <div class="form-layout-fields">
                <div class="form-field">
                    <span class="form-field-label">发送类型：</span>
                    <div class="form-radios">
                        <{foreach from=$send_type key=typeKey item=typeVal}>
                            <label><input name="send_type" type="radio" <{if $data.send_type==$typeKey}>checked<{/if}> value="<{$typeKey}>"><{$typeVal}></label>
                        <{/foreach}>
                    </div>
                </div>
            </div>
            <div class="form-layout-fields">
                <div class="form-field">
                    <span class="form-field-label">模板启用状态：</span>
                    <div class="form-radios">
                        <label><input name="disabled" type="radio" <{if $data.disabled=='false'}>checked<{/if}> value="false">启用</label>
                        <label><input name="disabled" type="radio" <{if $data.disabled=='true'}>checked<{elseif !$data}>checked<{/if}> value="true">禁用</label>
                    </div>
                </div>
            </div>
            <div class="form-layout-fields">
                <div class="form-field" style="width: 50%">
                    <span class="form-field-label">模板内容：</span>
                    <textarea class="form-input" name="content" id="template-content" style="height: 180px" placeholder="请输入模板内容" ><{$data.content}></textarea>
                </div>
            </div>
        </div>
        <div id="cc"  class="form-actions">
            <input type="hidden" name="template_id" value="<{$data.template_id}>">
            <button class="btn-primary" id="material-save-btn">保存</button>
            <{button type="button" label="返回" onclick="location.href=window.frameElement.src" }>
        </div>
    </form>
</div>
<script>
    Ex_Loader("tail.select", function(){
        tail.select('#event-type-select', {
            search: true,
            width: 300,
            height: 200,
            searchMinLength: 0
        });
    });
    // 根据event类型自动填充模板内容（参考 archive.html 的 addEvent 用法）
    (function(){
        var selectEl = $('event-type-select');
        var contentEl = $('template-content');
        if(!selectEl || !contentEl){return;}
        var fill = function(type){
            if(!type){return;}
            var holder = $('tpl-' + type);
            if(holder){ // 仅在空内容时自动填充，避免覆盖已有内容
                contentEl.value = holder.value;
            }
        };
        // 初次载入
        fill(selectEl.value);
        // 下拉变化时填充（若当前为空）
        selectEl.addEvent('change', function(){
            fill(this.value);
        });
    })();
</script>