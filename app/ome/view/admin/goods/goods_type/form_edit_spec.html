<!--
  Copyright © ShopeX （http://www.shopex.cn）. All rights reserved.
  See LICENSE file for license details.
-->

<div style=" padding:3px; margin:0;" id="form_style_spec">
  <div class="gridlist-action">
      <{button label="新增规格" class="addSpec" icon="btn_add.gif" app="desktop" }><span class="notice-inline"></span>
  </div>
  <div id="form_style_spec_header" class="gridlist-head"<{if !$gtype.spec}> style="display:none"<{/if}>>
    <div class="p_name span-3"><{t}>规格<{/t}></div>
 
    <div class="p_optionalias span-5"><{t}>操作<{/t}></div>
  </div>

  <div id="spec_box" class="gridlist" style=" height:130px; overflow:auto;border:1px solid #efefef; margin-bottom:10px;">
    <{if $gtype.spec}>
    <{foreach from=$gtype.spec item=spec}>
    <div class="row">
      <div class="p_name span-3" style="text-align:center"><{$spec.spec.spec_name}><{if $spec.spec.spec_memo}>（<{$spec.spec.spec_memo}>）<{/if}><input type="hidden" name="gtype[spec][spec_id][]" value="<{$spec.spec_id}>"></div>
      
        <div class="p_optionalias span-5" style="text-align:center">
            <{img style='cursor:pointer;' onclick="move_p(this,'up')" src="bundle/icon_asc.gif" alt="向上" class="operater" app='desktop'}>&nbsp;&nbsp; &nbsp;&nbsp;
	        <{img style='cursor:pointer;' onclick="move_p(this,'down')" src="bundle/icon_desc.gif" alt="向下" class="operater" app='desktop'}>&nbsp;&nbsp; &nbsp;&nbsp;
	        <{img style='cursor:pointer;' onclick='if(confirm(\'规格删除后将会影响商品列表页显示效果，确认要删除吗？\')){$(this).getParent(\'.row\').remove();}' src="bundle/delete.gif" alt="删除" class="operater" app='desktop'}>
        </div>
        <div style="clear:both"></div>
    </div>
    <{/foreach}>
    <{else}>
      <span id="form_style_spec_msg_none" style="color:#666666;"><{t}><{/t}></span>
    <{/if}>
  </div>
 
</div>

<script>
void function(){
       var tmpl_spec = '<div class="row">'+
      '<div class="p_name span-3"  style="text-align:center">{name}<input type="hidden" name="gtype[spec][spec_id][]" value="{id}"></div>'+
      '<div class="p_type span-5" style="text-align:center;display:none;"><select name="gtype[spec][spec_type][]">'+
        '<option value="flat"<{if $spec.spec_style=="flat"}> selected<{/if}>><{t}>可筛选-平铺显示<{/t}></option>'+
        '<option value="select"<{if $spec.spec_style=="select"}> selected<{/if}>><{t}>可筛选-下拉显示<{/t}></option>'+
        '<option value="disabled"<{if $spec.spec_style=="disabled"}> selected<{/if}>><{t}>不作为筛选项<{/t}></option>'+
        '</select></div>'+
        '<div class="p_optionalias span-5" style="text-align:center">'+
            '<{img style="cursor:pointer;" src="bundle/icon_asc.gif" alt="向上" onclick="move_p(this,\'up\')" class="operater" app=desktop}>&nbsp;&nbsp; &nbsp;&nbsp; <{img style="cursor:pointer;" src="bundle/icon_desc.gif" onclick="move_p(this,\'down\')" alt="向下" class="operater" app=desktop}>&nbsp;&nbsp; &nbsp;&nbsp; <{img style="cursor:pointer;" onclick="$(this).getParent(\'.row\').remove();" src="bundle/delete.gif" alt="删除" class="operater" app=desktop}>'+
        '</div>'+
        '<div style="clear:both"></div>'+
    '</div>';
       $E('#form_style_spec .addSpec').addEvent('click',function(){
              
              new Dialog('index.php?app=ome&ctl=admin_specification&act=selSpecDialog',{title:'选择规格',
                 onShow:function(){
                    this.dialog.store('callback',function(id,name){
                        var sign_id = false;
                        $('spec_box').getElements('input[type=hidden]').each(function(item){
                            if(item.value == id){
                                sign_id = true;
                            }
                        });
                        if(sign_id) return;
                        
                        $('form_style_spec_header').style.display = '';
                        if($('form_style_spec_msg_none')) $('form_style_spec_msg_none').style.display = 'none';

                        var js_obj = {'id':id,'name':name};
                        var obj = tmpl_spec.substitute(js_obj);
                        var e = new Element('div').setHTML(obj).getFirst();
                        $E('select',e).selectedIndex=0;
                        $('spec_box').adopt(e);
                    });
                 }
              })
       });
}();

function move_p(item,actdo){
    var item=$(item);
    if(!item)return;
    var div=item.getParent('div.row');
    var divp=div.getPrevious('div.row');
    var divn=div.getNext('div.row');
    switch (actdo) {
        case 'up':
            if(divp)div.injectBefore(divp);
              return ;
        case 'down':
            if(divn)div.injectAfter(divn);
            return;
    }
}
</script>
