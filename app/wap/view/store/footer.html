<!--
  Copyright © ShopeX （http://www.shopex.cn）. All rights reserved.
  See LICENSE file for license details.
-->

<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.3.2.js"></script>

<link rel="stylesheet" href="<{$env.app.res_url}>/css/footer.css">
<footer id="footer" class="fixed bottom">
    <nav class="icon-bar reverse two-up" data-topbar>
        <a href="<{$delivery_link.desktop}>" class="item <{if empty($action)}>active<{/if}>"><i class="icon-panel"></i><label>工作台</label></a>
        <a href="<{$delivery_link.mine}>" class="item <{if in_array($action, array('mine', 'user', 'passwd', 'info'))}>active<{/if}>"><i class="icon-user"></i><label>个人中心</label></a>
    </nav>
</footer>
<script src="<{$env.app.res_url}>/js/libs.min.js"></script>
<script src="<{$env.app.res_url}>/js/mobile.min.js"></script>
<script src="<{$env.app.res_url}>/js/main.min.js"></script>

<script>

    function setupWebViewJavascriptBridge( callback ) {
        if ( window.WebViewJavascriptBridge ) {
            return callback( WebViewJavascriptBridge )
        }
        if ( window.WVJBCallbacks ) {
            return window.WVJBCallbacks.push( callback )
        }
        window.WVJBCallbacks = [callback]

        var WVJBIframe = document.createElement( 'iframe' )
        WVJBIframe.style.display = 'none'
        WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__'
        document.documentElement.appendChild( WVJBIframe )
        setTimeout( function () {
            document.documentElement.removeChild( WVJBIframe )
        }, 0 )
    }
    
    // APP扫码测试
    setupWebViewJavascriptBridge(function(bridge) {
        bridge.registerHandler('NTBleScanCodeJSActionCallHandler', function(data, responseCallback) {
            console.log( 'NTBleScanCodeJSActionCallHandler: ', data )
            var activeElement = document.activeElement
            if ( activeElement.tagName.toLocaleLowerCase() == 'input' ) {
                $( activeElement ).val( data.keyword )
                document.querySelector( ".scan-form" ).submit();
            }/*  */
        })
    })
    
    // function NTBleScanCodeJSActionCallHandler( context ) {
    //     console.log( 'NTBleScanCodeJSActionCallHandler: ', context )
    //     var activeElement = document.activeElement
    //     if ( activeElement.tagName.toLocaleLowerCase() == 'input' ) {
    //         $( activeElement ).val( context.keyword )
    //         document.querySelector( ".scan-form" ).submit();
    //     }
    // }
</script>