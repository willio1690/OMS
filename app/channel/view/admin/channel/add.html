<!--
  Copyright © ShopeX （http://www.shopex.cn）. All rights reserved.
  See LICENSE file for license details.
-->

<div class="tableform">
  <div class="division">
  <form method="post" action="index.php?app=channel&ctl=admin_channel&act=save" id="form-group">    
      <input  type="hidden" name="channel[channel_id]" value="<{$data.channel_id}>"/>
        <table width="100%" cellspacing="0" cellpadding="0" border="0" >
          <tbody>
          <tr>
              <th><span style="color:red;font-weight:bold;">*&nbsp;</span>应用编号：</th>
              <td>
                  <{if $data.channel_bn}>
                      <{$data.channel_bn}>
                      <input class="x-input" type="hidden" name="channel[channel_bn]" value="<{$data.channel_bn}>" vtype="required"/>
                  <{else}>
                      <input class="x-input" type="text" name="channel[channel_bn]" value="" vtype="required"/>
                  <{/if}>
  
              </td>
          </tr>
          <tr>
              <th><span style="color:red;font-weight:bold;">*&nbsp;</span>应用名称：</th>
              <td><input class="x-input" type="text" name="channel[channel_name]" value="<{$data.channel_name}>"
                         vtype="required"/></td>
          </tr>
          <tr>
              <th>应用描述：</th>
              <td><input class="x-input" type="text" name="channel[memo]" value="<{$data.memo}>" /></td>
          </tr>
          <tr>
              <th><span style="color:red;font-weight:bold;">*&nbsp;</span>应用类型：</th>
              <td>
                  <{if $data.channel_type}>
                      <{$channel_type_name}>
                      <input type="hidden" name="channel[channel_type]" value="<{$data.channel_type}>" id='channel_type' />
                  <{else}>
                      <select name="channel[channel_type]" class="x-input" id='channel_type'>
                          <{foreach from=$channel_type item=value key=key}>
                              <option value="<{$key}>"><{$value}></option>
                          <{/foreach}>
                      </select>
                  <{/if}>
              </td>
          </tr>
          <tr>
              <th><em class="c-red">*</em> 接入渠道：</th>
              <td><{input type='select' name='channel[channel_adapter]' id='channel_adapter' vtype='required' rows=$adapter_list valueColumn='value' labelColumn='label' value=$data.channel_adapter}>
                  <ul style='color:red' id="adapter_desc">
                      <{foreach from=$adapter_list item=item}>
                          <li id="desc_<{$item.value}>" style="display:none"><{$item.desc}></li>
                      <{/foreach}>
                  </ul>
              </td>
          </tr>
          
          
          </tbody>
        </table>
          <div id='adapter_config'></div>
  </form>   
    </div>
  </div>
  <{area inject=".mainFoot"}>
  <div class="table-action">
    <table width="100%" cellspacing="0" cellpadding="0">
      <tbody>
        <tr>
          <td><button class="btn btn-primary" id="submit_btn" ><span><span><{t}>确定<{/t}></span></span></button></td>
        </tr>
      </tbody>
    </table>
  </div>
  <{/area}>
  <script>
var channel_id = undefined;
<{if $data.channel_id }>
var channel_id = "<{$data.channel_id}>";
$('channel_adapter').set('disabled', 'disabled');
<{/if}>
  (function(){
      var _form = $('form-group');//表单ID 
      var btn   = $('submit_btn');//按钮ID
      
      _form.store('target',{
          onComplete:function(){},
          onSuccess:function(response){
              var response = JSON.decode(response);
              if (response.success != undefined && response.success != ""){
                  try{
                      var _dialogIns = btn.getParent('.dialog').retrieve('instance');
                  }catch(e){}
  
                  if(_dialogIns){
                      _dialogIns.close();
                  }
              }
          }
      });
  
      btn.addEvent('click',function(){
        _form.fireEvent('submit',{stop:$empty});
      });
  
      // 接入方式切换获取配置函数
      $('channel_adapter').addEvents({
          'change': function (e) {
              if (!this.value) return;
  
              $ES('#adapter_desc li').hide();
              $ES('#adapter_desc #desc_' + this.value).show();
              
              let channel_type = $('channel_type').value;
              
              let url = 'index.php?app=channel&&ctl=admin_channel&act=confightml&p[0]='+channel_type + '&p[1]=' + this.value;
          
              if(channel_id != undefined){
                  url += '&p[2]=' + channel_id;
              }
              
              W.page(url, {
                  update: $('adapter_config'),
                  clearUpdateMap: false
              });
          },
          'domready': function (e) {
              this.fireEvent('change', e);
          }
      });
  })();
  </script>
  
